# h2 임베디드 모드 

![](https://i.imgur.com/PDNeB6g.png)


김영한 강의를 들으면서 위와 같은 테스트 코드를 작성하고 실제 삽입된 데이터 확인을 위해 Rollback을 false 로 설정해두었다. 
![](https://i.imgur.com/yrrsQFK.png)

테스트는 성공했고, Insert 쿼리가 실행된 것도 찍혔다. 

![](https://i.imgur.com/4Ngmfsy.png)

그러나 DB를 확인해보면 강의와 달리 테이블이 비어있어서 무엇이 문제인지 찾아봤다. 

강의와 내 코드의 차이는 없었고, 문제는 로컬 서버에서 DB를 다룬 강의와 달리 나는 임베디드 모드의 H2 DB를 사용한 점이었다. 임베디드 모드에서는 테스트가 끝났을때 db 도 함께 종료되어 실제 테이블이 유지되지 않는다. 

내가 보고 있는 h2 테이블은 프로젝트 서버를 돌렸을때 생성된 테이블인 것이다. 

따라서 테스트에서 데이터를 실제 확인하려면 db를 로컬 서버로 구동해야 한다. 
당장은 문제되는 부분이 아니니 넘어가도록 하겠다. 





# 로직 위치 

- 도메인 모델 패턴 : 엔티티가 비즈니스 로직을 가지고 객체지향의 특성을 적극 활용하는 것
- 트랜잭션 스크립트 패턴 : 엔티티가 아닌 서비스 계층에서 대부분의 비즈니스 로직을 처리하는 것

JPA 나 ORM 을 쓰면 도메인 모델 패턴 안에 핵심 로직을 넣는 것이 더 선호되는 듯 하나, 상황에 맞게 트레이드 오프 되기도 하고 무엇이 맞고 틀리고의 문제가 아니다. 

무엇이 더 유지보수 하기 쉬운가를 고민! 

도메인 모델 패턴으로 개발하면, 테스트시 레파지토리랑 상관없이 엔티티에서 중요 메서드를 단위 테스 할 수 있다. 